<p-dialog header="Profile Photo" [(visible)]="displayProfilePhotoDialog" [modal]="true" [draggable]="false"
    [resizable]="false" [closable]="true" [title]="false">
    <div class="m-0 text-center">
        <div *ngIf="uploadedProfileImage === ''" class="p-3 flex flex-column surface-ground p-link shadow-2"
            style="border-radius: 6px; height: 400px !important; width:  400px !important;">
        </div>

        <img *ngIf="uploadedProfileImage !== ''"
            style="border-radius: 6px; height: 400px !important; width:  400px !important;"
            class="border rounded shadow-sm p-25 img-fix-h img-fit img-fluid shadow-2" [src]="uploadedProfileImage"
            onError="uploadedProfileImage" alt="User avatar" />
    </div>
</p-dialog>

<p-dialog [(visible)]="displayRemoveProfilePhotoDialog" [modal]="true" [style]="{ width: '30vw' }" [draggable]="false"
    [resizable]="false" [closable]="false" [title]="false">
    <div style="margin-top: -3px !important;" class="mb-3 text-center">
        <p><strong>Remove your profile photo?</strong></p>
        <p-button label="Cancel" styleClass="p-button-raised p-button-text p-button-secondary px-6 mr-4"
            (click)="displayRemoveProfilePhotoDialog=false"></p-button>
        <p-button label="ok" styleClass="p-button-raised p-button-danger px-7"
            (click)="removeProfilePhoto()"></p-button>
    </div>
</p-dialog>


<div style="margin-top: -40px; z-index: 998" class="text-900 text-3xl font-medium page-title">
    <div class="mb-4 flex pt-0">
        <p-button icon="pi pi-chevron-circle-left" label="" (onClick)="goBack()"
            styleClass="p-button-sm p-button-text p-button-secondary p-button-rounded mr-2">
        </p-button>
        <p-breadcrumb styleClass="mt-2 pt-1" [model]="breadcrumbItems" [home]="{ icon: 'pi pi-home' }"></p-breadcrumb>
    </div>
</div>

<div class="text-900 text-3xl font-medium mb-2 mt-1 nunito-font">
    <span class="deep-green-font"><strong>User Administration</strong></span>
</div>

<div class="surface-card shadow-1 px-3 pb-3 border-round bg-light mt-3 nunito-font">
    <div *ngIf="showDetails" class="px-2 py-5 md:px-1 lg:px-3">
        <p-toast></p-toast>
        <div class="grid">
            <div class="col-12 lg:col-3">
                <!-- html -->
                <!-- html -->
                <p-menu styleClass="p-2" #menu [popup]="true" [model]="items"></p-menu>
                <div>
                    <div class="p-fileupload-buttonbar">
                        <span class="">
                            <input type="file" #profilePhotoUpload style="display: none" accept="image/*"
                                (change)="handleFileUpload($event)">
                        </span>
                    </div>
                    <div *ngIf="uploadedProfileImage === ''" class="p-3 flex flex-column surface-ground p-link shadow-2"
                        (click)="menu.toggle($event)" style="border-radius: 6px; height: 250px; width: 250px;">
                    </div>

                    <img *ngIf="uploadedProfileImage !== ''" style="border-radius: 6px; height: 250px; width: 250px;"
                        (click)="menu.toggle($event)"
                        class="border rounded shadow-sm p-25 img-fix-h img-fit img-fluid  p-link shadow-2"
                        [src]="uploadedProfileImage" onError="uploadedProfileImage" alt="User avatar" />
                </div>
                <!-- html -->

                <!-- html -->
                <div class="pb-5">
                    <p-divider align="left">
                        <div class="inline-flex align-items-center">
                            <i class="pi pi-briefcase mr-2"></i>
                            <b>Work</b>
                        </div>
                    </p-divider>
                    <div class="deep-green-font text-sm mb-1 font-medium">
                        <strong>Kano State Procurement Bureau</strong>
                    </div>
                    <span class="light-green-font line-height-3">Posuere sollicitudin aliquam ultrices sagittis.</span>
                </div>
                <div class="">
                    <p-divider align="left">
                        <div class="inline-flex align-items-center">
                            <i class="pi pi-briefcase mr-2"></i>
                            <b>Skils</b>
                        </div>
                    </p-divider>
                    <div class="deep-green-font mb-2 text-sm">
                        <strong>Technology</strong>
                    </div>
                    <div class="deep-green-font mb-2 text-sm">
                        <strong>Production</strong>
                    </div>
                    <div class="deep-green-font mb-2 text-sm">
                        <strong>Organization</strong>
                    </div>
                </div>
            </div>
            <div class="col-12 md:col-6 lg:col-9">
                <div class="surface-card">
                    <div class="justify-content-between mb-3">
                        <div>
                            <div class="deep-green-font font-medium text-3xl mb-2">
                                <strong>{{ user.full_name }}</strong>
                            </div>
                            <div class="light-green-font font-medium text-2xl mb-3">
                                <strong>
                                    <p class="m-b-10">
                                        Technical Assistant
                                    </p>
                                </strong>
                            </div>
                            <div class="light-green-font font-medium text-1xl mb-4">
                                <strong>
                                    <p class="m-b-10">
                                        <span class=""><span style="
                          background: #083a50;
                          color: #ffffff;
                          font-size: 1rem;
                        " class="p-tag px-3">STAFF CODE</span></span>
                                        {{ user.staff_code }}
                                    </p>
                                </strong>
                            </div>

                            <div class="mb-3 pl-1">
                                <span class="text-700 line-height-3"><strong>Created</strong>
                                    {{ user.created_at | date: 'MMM dd, yyyy' }}</span>
                            </div>
                            <div class="text-900 w-full md:flex-order-0 flex-order-1">
                                <p-button styleClass="p-button-text p-button-secondary mr-2" (click)="showProfileForm()"
                                    label="Edit" icon="pi pi-user-edit"></p-button>
                            </div>
                            <p-tabView [activeIndex]="1" styleClass="tabview-custom mt-1">
                                <p-tabPanel header="Header II">
                                    <ng-template pTemplate="header">
                                        <i class="pi pi-user mr-2"></i>
                                        <span>About</span>
                                    </ng-template>
                                    <div>
                                        <div class="deep-green-font mt-3 text-xl mb-2">
                                            <strong>Contact Information</strong>
                                        </div>
                                        <ul class="list-none p-0 m-0">
                                            <li class="flex align-items-center py-1 surface-border flex-wrap">
                                                <div class="deep-green-font w-6 md:w-2 font-medium">
                                                    <strong>Phone :</strong>
                                                </div>
                                                <div
                                                    class="light-green-font w-full md:w-10 md:flex-order-0 flex-order-1">
                                                    {{user.phone || 'No Record'}}
                                                </div>
                                            </li>
                                            <li class="flex align-items-center py-1 surface-border flex-wrap">
                                                <div class="deep-green-font w-6 md:w-2 font-medium">
                                                    <strong>Address :</strong>
                                                </div>
                                                <div
                                                    class="light-green-font w-full md:w-10 md:flex-order-0 flex-order-1">
                                                    {{user.address || 'No Record'}}
                                                </div>
                                            </li>
                                            <li class="flex align-items-center py-1 surface-border flex-wrap">
                                                <div class="deep-green-font w-6 md:w-2 font-medium">
                                                    <strong>Email :</strong>
                                                </div>
                                                <div
                                                    class="light-green-font w-full md:w-10 md:flex-order-0 flex-order-1">
                                                    {{user.email || 'No Record'}}
                                                </div>
                                            </li>
                                            <li class="flex align-items-center py-1 surface-border flex-wrap">
                                                <div class="deep-green-font w-6 md:w-2 font-medium">
                                                    <strong>Site :</strong>
                                                </div>
                                                <div
                                                    class="light-green-font w-full md:w-10 md:flex-order-0 flex-order-1">
                                                    {{user.profile?.site || 'No Record'}}
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <div>
                                        <div class="deep-green-font text-xl mt-3 mb-2">
                                            <strong>Basic Information</strong>
                                        </div>
                                        <ul class="list-none p-0 m-0">
                                            <li class="flex align-items-center py-1 surface-border flex-wrap">
                                                <div class="deep-green-font w-6 md:w-2 font-medium">
                                                    <strong>Birthday :</strong>
                                                </div>
                                                <div
                                                    class="light-green-font w-full md:w-10 md:flex-order-0 flex-order-1">
                                                    {{ user.birthday | date:'d MMM, yyyy' || 'No Record' }}
                                                </div>
                                            </li>
                                            <li class="flex align-items-center py-1 surface-border flex-wrap">
                                                <div class="deep-green-font w-6 md:w-2 font-medium">
                                                    <strong>Gender :</strong>
                                                </div>
                                                <div
                                                    class="light-green-font w-full md:w-10 md:flex-order-0 flex-order-1">
                                                    {{user.gender || 'No Record'}}
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </p-tabPanel>
                            </p-tabView>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <p-confirmDialog [style]="{ width: '30vw' }" [baseZIndex]="10000"></p-confirmDialog>

    <div *ngIf="displayForm" class="mt-3 pt-5 pl-3 pr-5">
        <div class="grid">
            <p-toast></p-toast>
            <div class="col-12 lg:col-3">
                <p-menu styleClass="p-2" #menu [popup]="true" [model]="items"></p-menu>
                <div>
                    <div class="p-fileupload-buttonbar">
                        <span class="">
                            <input type="file" #profilePhotoUpload style="display: none" accept="image/*"
                                (change)="handleFileUpload($event)">
                        </span>
                    </div>
                    <div *ngIf="uploadedProfileImage === ''" class="p-3 flex flex-column surface-ground p-link shadow-2"
                        (click)="menu.toggle($event)" style="border-radius: 6px; height: 250px; width: 250px;">
                    </div>

                    <img *ngIf="uploadedProfileImage !== ''" style="border-radius: 6px; height: 250px; width: 250px;"
                        (click)="menu.toggle($event)"
                        class="border rounded shadow-sm p-25 img-fix-h img-fit img-fluid  p-link shadow-2"
                        [src]="uploadedProfileImage" onError="uploadedProfileImage" alt="User avatar" />
                </div>
            </div>
            <div class="col-12 md:col-6 lg:col-9 pt-3 pl-4">
                <div class="deep-green-font font-medium text-3xl mb-2">
                    <strong>{{ user.full_name }}</strong>
                </div>
                <div class="light-green-font font-medium text-2xl mb-3">
                    <strong>
                        <p class="m-b-10">
                            Technical Assistant
                        </p>
                    </strong>
                </div>
                <div class="light-green-font font-medium text-1xl mb-4">
                    <strong>
                        <p class="m-b-10">
                            <span class=""><span style="
                    background: #083a50;
                    color: #ffffff;
                    font-size: 1rem;
                  " class="p-tag px-3">STAFF CODE</span></span>
                            {{ user.staff_code }}
                        </p>
                    </strong>
                </div>
                <div class="black-font text-2xl mb-1 font-medium">
                    <strong>Edit profile</strong>
                </div>
                <form class="form" [formGroup]="userProfileForm">
                    <div class="p-fluid">
                        <div class="field">
                            <label class="deep-green-font font-bold" for="address">Adress</label>
                            <input pInputText id="address" type="text" placeholder="34B 4th Avenue, Kano KN, Nigeria"
                                formControlName="address" [class.ng-invalid]="
                    userProfileForm.controls['address'].invalid &&
                    userProfileForm.controls['address'].touched
                  " />
                            <div *ngIf="
                  userProfileForm.controls['address'].invalid &&
                  userProfileForm.controls['address'].touched
                " class="p-error block">
                                <small id="address" class="p-error block"
                                    *ngIf="userProfileForm.controls['address'].errors?.['required']">
                                    This field is required
                                </small>
                                <small id="address" class="p-error block"
                                    *ngIf="userProfileForm.controls['address'].errors?.['minlength']">
                                    Character must be at least 3
                                </small>
                            </div>
                        </div>
                        <div class="field">
                            <label class="deep-green-font font-bold" for="phone">Phone</label>
                            <input pInputText id="phone" type="text" placeholder="+23423789278" formControlName="phone"
                                [class.ng-invalid]="
                    userProfileForm.controls['phone'].invalid &&
                    userProfileForm.controls['phone'].touched
                  " />
                            <div *ngIf="
                  userProfileForm.controls['phone'].invalid &&
                  userProfileForm.controls['phone'].touched
                " class="p-error block">
                                <small id="phone" class="p-error block"
                                    *ngIf="userProfileForm.controls['phone'].errors?.['required']">
                                    This field is required
                                </small>
                                <small id="phone" class="p-error block"
                                    *ngIf="userProfileForm.controls['phone'].errors?.['minlength']">
                                    Character must be at least 3
                                </small>
                            </div>
                        </div>
                        <div class="field">
                            <label class="deep-green-font font-bold" for="site">Site</label>
                            <input pInputText id="site" type="text" placeholder="www.johndoe.com" formControlName="site"
                                [class.ng-invalid]="
                    userProfileForm.controls['site'].invalid &&
                    userProfileForm.controls['site'].touched
                  " />
                            <div *ngIf="
                  userProfileForm.controls['site'].invalid &&
                  userProfileForm.controls['site'].touched
                " class="p-error block">
                                <small id="site" class="p-error block"
                                    *ngIf="userProfileForm.controls['site'].errors?.['required']">
                                    This field is required
                                </small>
                                <small id="site" class="p-error block"
                                    *ngIf="userProfileForm.controls['site'].errors?.['minlength']">
                                    Character must be at least 3
                                </small>
                                <small class="pl-1 p-error block"
                                    *ngIf="userProfileForm.controls['site'].errors?.['incorrect']">
                                    This staff has already been added*
                                </small>
                            </div>
                        </div>
                        <div class="field">
                            <label class="deep-green-font font-bold" for="birthday">Gender</label>
                            <p-dropdown [options]="genders" formControlName="gender" placeholder="Select Gender"
                                optionLabel="name" optionValue="name" [showClear]="true"></p-dropdown>
                            <div *ngIf="
                  userProfileForm.controls['gender'].invalid &&
                  userProfileForm.controls['gender'].touched
                " class="p-error block">
                                <small id="gender" class="p-error block"
                                    *ngIf="userProfileForm.controls['gender'].errors?.['required']">
                                    This field is required
                                </small>
                                <small id="gender" class="p-error block"
                                    *ngIf="userProfileForm.controls['gender'].errors?.['minlength']">
                                    Character must be at least 3
                                </small>
                            </div>
                        </div>
                        <div class="field">
                            <label class="deep-green-font font-bold" for="birthday">Birthday</label>
                            <p-calendar styleClass="" [showIcon]="true" inputId="icon" placeholder="DD/MM/YY"
                                formControlName="birthday" [class.ng-invalid]="
                  userProfileForm.controls['birthday'].invalid &&
                  userProfileForm.controls['birthday'].touched
                "></p-calendar>
                            <div *ngIf="
                  userProfileForm.controls['birthday'].invalid &&
                  userProfileForm.controls['birthday'].touched
                " class="p-error block">
                                <small id="birthday" class="p-error block"
                                    *ngIf="userProfileForm.controls['birthday'].errors?.['required']">
                                    This field is required
                                </small>
                            </div>
                        </div>
                        <div class="field">
                            <label class="deep-green-font font-bold" for="site">Skills</label>
                            <div *ngFor="let skill of skills; index as i">
                                <div
                                    class="my-3 flex align-items-start flex-column sm:justify-content-between sm:flex-row w-full">
                                    <div class="col-11">
                                        <input pInputText [value]="getSkill(i)" [(ngModel)]="skills[i].name"
                                            [ngModelOptions]="{standalone: true}">
                                    </div>
                                    <div class="col-1">
                                        <p-button (onClick)="removeSkill(i)" label="X"></p-button>
                                    </div>
                                </div>
                            </div>
                            <input pInputText id="skills" type="text" placeholder="Skill Name" formControlName="skills"
                                [class.ng-invalid]="
                    userProfileForm.controls['skills'].invalid &&
                    userProfileForm.controls['skills'].touched
                  " />
                            <div *ngIf="
                  userProfileForm.controls['skills'].invalid &&
                  userProfileForm.controls['skills'].touched
                " class="p-error block">
                                <small id="skills" class="p-error block"
                                    *ngIf="userProfileForm.controls['skills'].errors?.['required']">
                                    This field is required
                                </small>
                                <small id="skills" class="p-error block"
                                    *ngIf="userProfileForm.controls['skills'].errors?.['minlength']">
                                    Character must be at least 3
                                </small>
                            </div>
                            <div class="col-1">
                                <p-button (onClick)="addSkill()" label="add" [disabled]="!canAddSkill"></p-button>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="flex align-items-start flex-column lg:justify-content-between lg:flex-row">
                    <div>
                        <div class="flex align-items-center text-700 flex-wrap">
                        </div>
                    </div>
                    <div class="mt-3 lg:mt-0">
                        <button pButton pRipple label="Cancel"
                            class="p-button-outlined p-button-raised p-button-secondary mr-2" icon="pi pi-times"
                            (click)="cancel()"></button>
                        <button class="p-button-raised" (click)="update()" pButton pRipple label="Save"
                            icon="pi pi-check" [disabled]="!canSubmitProfile"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
